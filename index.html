<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Tasks Tracker V1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1f2937;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    .app {
      max-width: 540px;
      width: 100%;
      margin: 0 16px;
      padding: 40px;
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }

    h1 {
      margin: 0 0 32px;
      font-size: 32px;
      font-weight: 800;
      text-align: center;
      color: #111827;
      letter-spacing: -1px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 28px;
    }

    .controls-row {
      display: flex;
      gap: 12px;
    }

    #task-input,
    #deadline-input {
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      font-size: 15px;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      color: #1f2937;
      background: #ffffff;
    }

    #task-input {
      flex: 1;
    }

    #deadline-input {
      flex: 0 0 150px;
    }

    #task-input::placeholder,
    #deadline-input::placeholder {
      color: #d1d5db;
      font-weight: 500;
    }

    #task-input:focus,
    #deadline-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12);
      background: #f9fafb;
    }

    button {
      padding: 13px 24px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      text-transform: capitalize;
    }

    #add-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      align-self: flex-end;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    #add-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    #add-button:active {
      transform: translateY(0);
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 28px;
      flex-wrap: wrap;
    }

    .filter-button {
      background: #f3f4f6;
      border: 2px solid #e5e7eb;
      color: #6b7280;
      padding: 9px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .filter-button:hover {
      border-color: #d1d5db;
      background: #ffffff;
      color: #374151;
    }

    .filter-button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      color: #ffffff;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    #task-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #task-list li {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
      padding: 16px 18px;
      border-radius: 14px;
      background: #f9fafb;
      border: 2px solid #f3f4f6;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #task-list li:hover {
      border-color: #e5e7eb;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    .task-info {
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: 6px;
      min-width: 0;
    }

    #task-list li span {
      flex: 1;
      word-break: break-word;
      font-size: 15px;
      font-weight: 500;
      color: #111827;
      line-height: 1.4;
    }

    .task-deadline {
      font-size: 13px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }

    .task-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .task-actions button {
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .task-actions button:not(.btn-delete) {
      background: #e0e7ff;
      color: #4f46e5;
    }

    .task-actions button:not(.btn-delete):hover {
      background: #c7d2fe;
      transform: translateY(-1px);
    }

    .task-done {
      text-decoration: line-through;
      opacity: 0.5;
    }

    .btn-delete {
      background: #fee2e2;
      color: #991b1b;
    }

    .btn-delete:hover {
      background: #fca5a5;
      transform: translateY(-1px);
    }

    .task-overdue {
      background: #fef2f2 !important;
      border-color: #fecaca !important;
    }

    .task-overdue:hover {
      background: #ffffff !important;
    }

    .task-overdue .task-deadline {
      color: #dc2626;
      font-weight: 700;
    }

    @media (max-width: 480px) {
      .app {
        padding: 28px 20px;
        border-radius: 16px;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 24px;
      }

      #deadline-input {
        flex: 0 0 130px;
      }

      #task-list li {
        padding: 14px 16px;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h1>

    <div class="controls">
      <input id="task-input" type="text" placeholder="–ù–∞–ø–∏—à–∏ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É‚Ä¶" />
      <div class="controls-row">
        <input id="deadline-input" type="text" placeholder="–¥–¥/–º–º/–≥–≥–≥–≥" maxlength="10" />
        <button id="add-button">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <div class="filters">
      <button class="filter-button active" data-filter="all">–í—Å–µ</button>
      <button class="filter-button" data-filter="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
      <button class="filter-button" data-filter="done">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
    </div>

    <ul id="task-list"></ul>
  </div>

  <script>
    const input = document.getElementById('task-input');
    const deadlineInput = document.getElementById('deadline-input');
    const addButton = document.getElementById('add-button');
    const list = document.getElementById('task-list');
    const filterButtons = Array.from(document.querySelectorAll('.filter-button'));

    /** @type {{ id: number, text: string, done: boolean, deadline: string | null }[]} */
    let tasks = [];
    let nextId = 1;
    let currentFilter = 'all';

    function getTimeUntilDeadline(deadline) {
      if (!deadline) return null;
      const now = new Date();
      const deadlineDate = new Date(deadline + 'T23:59:59');
      const diffMs = deadlineDate - now;

      if (diffMs < 0) {
        const daysPassed = Math.floor(-diffMs / (1000 * 60 * 60 * 24));
        return `–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ${daysPassed} ${daysPassed === 1 ? '–¥–µ–Ω—å' : '–¥–Ω–µ–π'}`;
      }

      const daysLeft = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      const hoursLeft = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

      if (daysLeft > 0) {
        return `–æ—Å—Ç–∞–ª–æ—Å—å ${daysLeft} ${daysLeft === 1 ? '–¥–µ–Ω—å' : '–¥–Ω–µ–π'}`;
      }
      if (hoursLeft > 0) {
        return `–æ—Å—Ç–∞–ª–æ—Å—å ${hoursLeft} ${hoursLeft === 1 ? '—á–∞—Å' : '—á–∞—Å–æ–≤'}`;
      }
      return '–æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ —á–∞—Å–∞';
    }

    function isOverdue(deadline) {
      if (!deadline) return false;
      const deadlineDate = new Date(deadline + 'T23:59:59');
      return deadlineDate < new Date();
    }

    function formatDeadlineInput(value) {
      const cleaned = value.replace(/\D/g, '');
      if (cleaned.length <= 2) return cleaned;
      if (cleaned.length <= 4) return cleaned.slice(0, 2) + '/' + cleaned.slice(2);
      return cleaned.slice(0, 2) + '/' + cleaned.slice(2, 4) + '/' + cleaned.slice(4, 8);
    }

    function convertDdMmGgggToIso(ddMmGggg) {
      const parts = ddMmGggg.split('/');
      if (parts.length !== 3) return null;
      const [dd, mm, gggg] = parts;
      if (dd.length !== 2 || mm.length !== 2 || gggg.length !== 4) return null;
      const day = parseInt(dd, 10);
      const month = parseInt(mm, 10);
      const year = parseInt(gggg, 10);
      if (day < 1 || day > 31 || month < 1 || month > 12 || year < 1900 || year > 2100) return null;
      return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
    }

    function renderTasks() {
      list.innerHTML = '';
      const visibleTasks = tasks.filter(task => {
        if (currentFilter === 'active') return !task.done;
        if (currentFilter === 'done') return task.done;
        return true;
      });

      visibleTasks.forEach(task => {
        const li = document.createElement('li');

        const textSpan = document.createElement('span');
        textSpan.textContent = task.text;
        if (task.done) {
          textSpan.classList.add('task-done');
        }

        const taskInfo = document.createElement('div');
        taskInfo.className = 'task-info';
        taskInfo.appendChild(textSpan);

        if (task.deadline) {
          const deadlineSpan = document.createElement('div');
          deadlineSpan.className = 'task-deadline';
          const [y, m, d] = task.deadline.split('-');
          deadlineSpan.textContent = `üìÖ ${d}/${m}/${y} ‚Ä¢ ${getTimeUntilDeadline(task.deadline)}`;
          taskInfo.appendChild(deadlineSpan);
        }

        const doneButton = document.createElement('button');
        doneButton.textContent = task.done ? '–°–Ω—è—Ç—å –æ—Ç–º–µ—Ç–∫—É' : '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
        doneButton.addEventListener('click', () => {
          task.done = !task.done;
          renderTasks();
        });

        const deleteButton = document.createElement('button');
        deleteButton.textContent = '–£–¥–∞–ª–∏—Ç—å';
        deleteButton.classList.add('btn-delete');
        deleteButton.dataset.mode = 'normal';
        deleteButton.addEventListener('click', () => {
          if (deleteButton.dataset.mode !== 'confirm') {
            deleteButton.dataset.mode = 'confirm';
            deleteButton.textContent = '–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å?';

            setTimeout(() => {
              if (deleteButton.dataset.mode === 'confirm') {
                deleteButton.dataset.mode = 'normal';
                deleteButton.textContent = '–£–¥–∞–ª–∏—Ç—å';
              }
            }, 2500);

            return;
          }

          tasks = tasks.filter(t => t.id !== task.id);
          renderTasks();
        });

        const actions = document.createElement('div');
        actions.className = 'task-actions';
        actions.appendChild(doneButton);
        actions.appendChild(deleteButton);

        li.appendChild(taskInfo);
        li.appendChild(actions);

        if (isOverdue(task.deadline)) {
          li.classList.add('task-overdue');
        }

        list.appendChild(li);
      });
    }

    function addTask() {
      const text = input.value.trim();
      if (!text) return;
      let deadline = null;
      if (deadlineInput.value.trim()) {
        deadline = convertDdMmGgggToIso(deadlineInput.value.trim());
        if (!deadline) {
          alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–µ–¥–ª–∞–π–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î/–ú–ú/–ì–ì–ì–ì');
          return;
        }
      }
      tasks.push({ id: nextId++, text, done: false, deadline });
      input.value = '';
      deadlineInput.value = '';
      renderTasks();
      input.focus();
    }

    addButton.addEventListener('click', addTask);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        addTask();
      }
    });
    deadlineInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        addTask();
      }
    });
    deadlineInput.addEventListener('input', (e) => {
      e.target.value = formatDeadlineInput(e.target.value);
    });

    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const value = btn.getAttribute('data-filter');
        if (!value) return;
        currentFilter = value;

        filterButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        renderTasks();
      });
    });

    setInterval(() => {
      renderTasks();
    }, 60000);
  </script>
</body>
</html>

